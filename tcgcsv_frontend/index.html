<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="TCGCSV"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://tcgcsv.com"/>
    <meta property="og:description" content="TCGPlayer category, group, and product information updated daily"/>
    <meta name="theme-color" content="#663399">
    <title>TCGCSV</title>
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="icon" href="/favicon.ico" sizes="32x32">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&display=swap">
    <style>
      body { color: Black; background-color: White; margin-inline: 16px; font-family: 'Arial', sans-serif; line-height:1.3; }
      a:visited { color: #639; }

      header { display: grid; grid-template-columns: 1fr min-content; column-gap: 8px; }
      .external-nav { display: grid; align-items: center; grid-template-columns: repeat(4, min-content); column-gap: 32px; }
      .external-nav a img { height: 40px; }

      summary { font-size: 24px; margin-bottom: 4px; border-bottom: 1px solid #000; }
      summary, h1, h3 { font-family: 'Roboto Slab', serif; }
      .z { color: #AAA; }

      table { display:grid; grid-template-columns: minmax(120px,9fr) minmax(120px,1fr) minmax(120px,10fr); margin-bottom: 16px; }
      thead,tbody,tr { display: contents; }
      th { position: sticky; top: 0; background: #DDD; text-align: left; padding-block: 8px; }
      td { padding-block: 6px; }
      td:last-child { padding-bottom: 4px; }
      tr:nth-child(even) td { background: #EEE; }

      @media (prefers-color-scheme: dark) {
        body { color: White; background-color: #222; }
        a { color: SkyBlue; }
        a:visited, .s { color: #a7d; }

        summary { border-bottom: 1px solid #555; }
        .z { color: #666; }

        tr:nth-child(even) td { background: #333; }
        th { background: #444; }
      }
      @media (max-width: 576px) {
        body { margin-inline: 8px; }

        header { grid-template-columns: 1fr; }

        table { grid-template-columns: 1fr; }
        td { padding-block: 1px; }
        thead, td:nth-child(2) { display: none; }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>TCGPlayer CSV & JSON&nbsp;Dumps</h1>
      <nav class="external-nav">
        <a target="_blank" rel="noopener noreferrer" href="https://github.com/CptSpaceToaster/tcgcsv"><img alt="Github Repo" src="/github-mark.svg"></a>
        <a target="_blank" rel="noopener noreferrer" href="https://discord.gg/bydv2BNV25"><img alt="Join Discord" src="/discord-mark.svg"></a>
        <a target="_blank" rel="noopener noreferrer" href="https://www.patreon.com/TCGCSV"><img alt="Support me on Patreon!" src="/patreon-symbol-mark.svg"></a>
        <a target="_blank" rel="noopener noreferrer" href="https://cpt.tcgcsv.com"><img alt="TCGPlayer Affiliate Link" src="/TCGplayer-logo-primary.png"></a>
      </nav>
    </header>
    <section>
      <h3>Ahoy!</h3>
      <p>This website is a personal project of mine that exposes categories, groups, products, and prices from TCGPlayer's API. The results are shared here for folks who can't get access to TCGPlayer's API. All responses used to generate the content on this website are cached as unmodified JSON text-files. The CSV's that I've put together DO have my personal affiliate links in there.</p>
      <ul>
        <li>You can see my terraform learnings, AWS infrastructure, and open source mess for this website on <a target="_blank" rel="noopener noreferrer" href="https://github.com/CptSpaceToaster/tcgcsv">Github</a></li>
        <li>You can join this <a target="_blank" rel="noopener noreferrer" href="https://discord.gg/bydv2BNV25">discord</a> to contact me, get updates, and talk about what would be cool to have next!</li>
        <li>If you would like to support this project, you can become a member on <a href="https://www.patreon.com/TCGCSV">Patreon</a> to help keep the lights on!</li>
      </ul>
    </section>
    <section>
      <h3>Updates</h3>
      <p>
        <div id="schedule">All content <i>should</i> update daily around 20:00:00 UTC</div>
        <div id="updated-at"><a target="_blank" rel="noopener noreferrer" href="last-updated.txt">Last updated</a> at: </div>
      </p>
    </section>
    <main id="info">
      <h3>Files</h3>
      <p>TCGPlayer has 4 tiers of information.
        <ol>
          <li>
            <p>At the root are <a target="_blank" rel="noopener noreferrer" href="https://docs.tcgplayer.com/reference/catalog_getcategories-1">Categories</a>. Each category roughly translates to a card game or a collection of merchandise.
            <br>categoryId: 3 is Pokemon
            </p>
          </li>
          <li>
            <p>Each category has <a target="_blank" rel="noopener noreferrer" href="https://docs.tcgplayer.com/reference/catalog_getcategorygroups-1">Groups</a>. Each group roughly translates to a set in a card game.
              <br>groupId: 3170 is Pokemon's - <i>SWSH12: Silver Tempest</i> set.
            </p>
          </li>
          <li>
            <p>Each group has <a target="_blank" rel="noopener noreferrer" href="https://docs.tcgplayer.com/reference/catalog_getproducts-1">Products</a>. Products can be sealed boxes, packs, or individual cards!
              <br>Products have nested "extendedData" which is where TCGPlayer usually stores a card's text, rarity, and set number.
              <br>Products have separate <a target="_blank" rel="noopener noreferrer" href="https://docs.tcgplayer.com/reference/pricing_getproductprices-1">Market Price</a> objects available in a parallel collection that need to be joined via a productId.
              <br>productId: 451396 is <i>Lugia VSTAR</i>
            </p>
          </li>
          <li>
            <p>Past this point, Products have "SKUs". A SKU is combination of a Product, Language, Printing, and Condition. However, <b>this project does not share information about SKUs.</b> This means that you will <b>not</b> be able to get prices for each condition of a card.
            </p>
          </li>
        </ol>
      </p>
      <details open>
        <summary>Root information</summary>
        <p style="margin-top: 0;">
          <a target="_blank" rel="noopener noreferrer" href="categories">Categories</a>
          <a href="Categories.csv">Categories.csv</a>
        </p>
      </details>
      <details>
        <summary>Category information</summary>
        <table>
          <thead>
            <tr>
              <th>Category Name</th>
              <th>Category ID</th>
              <th>Files</th>
            </tr>
          </thead>
          <tbody id="category-table"></tbody>
        </table>
      </details>
    </main>
    <footer>
      <p>Special thanks to our friends:</p>
      <ul>
        <li>luceleaftea for maintaining a separate pile of CSVs on <a target="_blank" rel="noopener noreferrer" href="https://github.com/the-fab-cube/flesh-and-blood-cards">Github</a> for Flesh and Blood</li>
        <li>nago for hosting a wonderful pile of pokemon related assets over at <a target="_blank" rel="noopener noreferrer" href="https://malie.io/static/">Malie.io</a></li>
        <li>ZeldaZach for helping answer questions in TCGPlayer's discord with me, while also maintaining <a target="_blank" rel="noopener noreferrer" href="https://mtgjson.com">MTGJSON.com</a></li>
        <li>And viewers like you!</li>
      </ul>
    </footer>
  </body>
  <script>
    function addTable(main, col1Name, col2Name, col3Name) {
      const table = document.createElement('table');

      const thead = document.createElement('thead');
      const tr = document.createElement('tr');
      const col1 = document.createElement('th');
      col1.innerHTML = col1Name;
      tr.appendChild(col1);
      const col2 = document.createElement('th');
      col2.innerHTML = col2Name;
      tr.appendChild(col2);
      const col3 = document.createElement('th');
      col3.innerHTML = col3Name;
      tr.appendChild(col3);
      thead.appendChild(tr);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');
      table.appendChild(tbody);

      main.appendChild(table);

      return table;
    }

    function addLinkColumn(column, linkText, url) {
      const a = document.createElement('a');
      a.innerHTML = linkText;
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.href = url;
      column.appendChild(a);
    }

    function addTableLine(table, col1Text, col2Text, link1, url1, link2, url2, link3, url3) {
      const tr = document.createElement('tr');
      const col1 = document.createElement('td');
      col1.innerHTML = col1Text;
      tr.appendChild(col1);
      const col2 = document.createElement('td');
      col2.innerHTML = col2Text;
      tr.appendChild(col2);
      const col3 = document.createElement('td');
      if (link1) {
        addLinkColumn(col3, link1, url1);
        col3.append(" ");
      }
      if (link2) {
        addLinkColumn(col3, link2, url2);
        col3.append(" ");
      }
      if (link3) {
        addLinkColumn(col3, link3, url3);
      }
      tr.appendChild(col3);

      table.appendChild(tr);
    }

    function addLinkLine(grid, title, subtitle, f1, h1, f2, h2, f3, h3, even) {
      const titleDiv = document.createElement('div');
      titleDiv.classList.add('l');

      if (even) titleDiv.classList.add('e');

      const titleSpan = document.createElement('span');
      titleSpan.append(title);
      titleDiv.appendChild(titleSpan);

      if (subtitle != null) {
        const subtitleSpan = document.createElement('span');
        subtitleSpan.append(subtitle);
        subtitleSpan.classList.add('z');
        titleDiv.appendChild(subtitleSpan);
      }

      grid.appendChild(titleDiv);

      const links = document.createElement('div');
      links.classList.add('l');
      links.classList.add('links');
      if (even) links.classList.add('e');

      const a1 = document.createElement('a');
      a1.innerHTML = f1;
      a1.target = '_blank';
      a1.rel = 'noopener noreferrer';
      a1.href = h1;
      links.appendChild(a1);
      links.appendChild(document.createTextNode(" "));

      if (f2) {
        const a2 = document.createElement('a');
        a2.innerHTML = f2;
        a2.target = '_blank';
        a2.rel = 'noopener noreferrer';
        a2.href = h2;
        links.appendChild(a2);
        links.appendChild(document.createTextNode(" "));
      }

      const a3 = document.createElement('a');
      a3.innerHTML = f3;
      a3.href = h3;
      links.appendChild(a3);

      grid.appendChild(links);
    }

    async function addCategory(parent, category) {
      if (category.categoryId === 21) return;

      const detail = document.createElement('details');
      parent.appendChild(detail);

      let groups;
      let groupsLength = 0
      if (![69, 70].includes(category.categoryId)) {
        const groupsResponse = await fetch(`${category.categoryId}/groups`);
        groups = (await groupsResponse.json()).results;
        groups.sort((a, b) => {
          return a.groupId - b.groupId;
        });
        groupsLength = groups.length
      }

      const summary = document.createElement('summary');
      summary.innerHTML = `${category.name} (${groupsLength})`;
      if (groupsLength === 0) summary.classList.add('z');

      const table = addTable(detail, `${category.name} Group Name`, "Group ID", "Files")
      if (groupsLength) {
        groups.forEach((group) => {
          addTableLine(
            table,
            group.name,
            group.groupId,
            'Products',
            `${category.categoryId}/${group.groupId}/products`,
            'Prices',
            `${category.categoryId}/${group.groupId}/prices`,
            'ProductsAndPrices.csv',
            `${category.categoryId}/${group.groupId}/ProductsAndPrices.csv`,
          )
        });
      }

      detail.appendChild(summary);
      detail.appendChild(contentGrid);
    }


    async function load() {
      updated = document.getElementById('updated-at');
      const lastUpdatedDate = new Date((await (await fetch("last-updated.txt")).text()).trim());

      timestampOptions = {
        year: "numeric",
        month: "numeric",
        day: "numeric",
        hour: "numeric",
        minute: "numeric",
        second: "numeric",
        timeZoneName: "short",
      }

      // Get current locale
      updated.appendChild(document.createTextNode(lastUpdatedDate.toLocaleString('en-US', timestampOptions)));

      const categoriesResponse = await fetch("categories");
      const categories = (await categoriesResponse.json()).results;
      categories.sort((a, b) => {
        return a.categoryId - b.categoryId;
      });

      main = document.getElementById('info');

      categoryTable = document.getElementById('category-table');

      categories.forEach((category) => {
        addTableLine(
          categoryTable,
          category.name,
          category.categoryId,
          'Groups',
          `${category.categoryId}/groups`,
          'Groups.csv',
          `${category.categoryId}/Groups.csv`
        );

        addCategory(main, category);
      });

    }
    load();
  </script>
</html>
